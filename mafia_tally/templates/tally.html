{% macro picture(name) -%}
<img src="{{ pictures[name] }}" alt="{{ name }}" title="{{ name }}" width="50" height="50" />
{%- endmacro %}

<h1>Day {{ config.day_id }} Votes</h1>
<div class="visual-tally">
    {%- for victim, voters in votes %}
    <p>{{ picture(victim) }} voted by {% for voter in voters %}{{ picture(voter) }}{% endfor %} <span class="tally-count">({{ tally.num_votes[victim] }})</span></p>
    {%- endfor %}

    <p>Abstaining: {% for player in tally.abstaining %}{{ picture(player) }}{% endfor %}</p>
    <p>Haven't voted: {% for player in tally.get_did_not_vote()|sort %}{{ picture(player) }}{% endfor %}</p>
</div>

<p>Last updated: {{ now }}</p>

<h2>Comments</h2>
<table>
    <thead><tr><th>User</th><th>Comment</th><th>Notes</th><th width="1"></th></tr></thead>
    <tbody>
        {%- for comment, details in comments %}
        <tr>
            {%- if comment is none %}
            <td></td><td><i>({{ details }} comment{{ 1*(details != 1) * 's' }} skipped)</i></td><td></td><td></td>
            {% else %}
            <td>{{ picture(comment.from.name) }}</td>
            <td><b>{{ comment.from.name }}</b><p>{{ comment.message|nl2br }}</p></td>
            <td>
                {%- for detail in details %}
                {{ detail }}
                {%- endfor %}
            </td>
            <td><a href="https://www.facebook.com/groups/{{ config.group_id }}/permalink/{{ config.post_id }}?comment_id={{ comment.id }}">x</a></td>
            {% endif %}
        </tr>
        {%- endfor %}
    </tbody>
</table>
